
```C
#ifdef _OPENMP
#include <omp.h>
#endif
```
- l'header viene inlcuso solo se è effettivamente presente

lo stesso if va messo prima di quando si chiamano le funzioni di OpenMP

```C
#ifdef _OPENMP
int my_rank = omp_get_thread_num ( );
int thread_count = omp_get_num_threads ( );
#else
int my_rank = 0;
int thread_count = 1;
#endif
```

## example: trapezoidal rule
Si dividono i trapezoidi tra i thread

![[threads-trapezoidal.png|center|400]]

unpredictable results when 2+ threads attempt

+copie delle var nei registri potenzialmente non consistenti - si possono perdere i cambiamenti

**mutual exclusion** (sezione critica)
```C
# pragma omp critical
	global_result += my_result;
```

the compiler replaces it with pthread lock and unlocks



- probabilmente fa una riduzione ad albero
- meglio mettere una riduzione che una sezione critica (alla peggio mette lui una sezione critica, ma probabilmente sarà più efficiente)


- ognuno fa una copia della variabile accumulatore, inizializzata al valore identita' dell'op specificata

```C
int acc = 6;
#pragma omp parallel num_threads(5) reduction(* : acc)
{
acc += omp_get_thread_num();
printf("thread %d: private acc is
%d\n",omp_get_thread_num(),acc);
}
printf("after: acc is %d\n",acc)
```
(non andrebbe usata un'operazione diversa da quella specificata) 


